<!DOCTYPE html>
<html>
<head>
  <title>Batch Apply</title>
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0/dist/css/select2.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0/dist/js/select2.min.js"></script>
  {% include 'navbar.html' %}
</head>
<body>
  <h2>ðŸ“¦ Batch Apply to Matching Jobs</h2>
  <p>
    <a href="{{ url_for('dashboard') }}">Dashboard</a> |
    <a href="{{ url_for('manual_jobs') }}">Manual Apply</a> |
    <a href="{{ url_for('applications') }}">Applications</a>
  </p>

  {% if jobs %}
    <!-- Dropdown Filters -->
    <p>
      <label>Filter by Job Titles:</label><br>
      <select id="titleFilter" multiple style="width: 300px;">
        {% for job in jobs|unique(attribute='title') %}
          <option value="{{ job.title|lower }}">{{ job.title }}</option>
        {% endfor %}
      </select>
    </p>
    <p>
      <label>Filter by Company:</label><br>
      <select id="companyFilter" multiple style="width: 300px;">
        {% for job in jobs|unique(attribute='company') %}
          <option value="{{ job.company|lower }}">{{ job.company }}</option>
        {% endfor %}
      </select>
    </p>
    <form method="POST">
      <p>
        <input type="checkbox" id="selectAll"> <label for="selectAll">Select All Jobs</label>
      </p>
      <ul>
        {% for job in jobs %}
        <li class="job-item" data-title="{{ job.title|lower }}" data-company="{{ job.company|lower }}">
          <input type="checkbox" name="job_links" value="{{ job.link }}" checked>
          <strong class="job-title">{{ job.title }}</strong> @
          <span class="job-company">{{ job.company }}</span><br>
          <a href="{{ job.link }}" target="_blank">View Job</a>
        </li><br>
        {% endfor %}
      </ul>
      <button type="submit">ðŸš€ Apply Selected Jobs</button>
    </form>
  {% else %}
    <p>ðŸ˜• No jobs matched your profile. Try updating <a href="{{ url_for('profile') }}">your profile</a>.</p>
  {% endif %}

  <script>
  $(document).ready(function() {
    $('#titleFilter, #companyFilter').select2({ placeholder: "Filter", allowClear: true });

    $('#titleFilter, #companyFilter').change(function () {
      filterJobs();
    });

    function filterJobs() {
      let selectedTitles = $('#titleFilter').val() || [];
      let selectedCompanies = $('#companyFilter').val() || [];

      $('.job-item').each(function () {
        let title = $(this).data('title');
        let company = $(this).data('company');

        let titleMatch = selectedTitles.length === 0 || selectedTitles.includes(title);
        let companyMatch = selectedCompanies.length === 0 || selectedCompanies.includes(company);

        if (titleMatch && companyMatch) {
          $(this).show();
        } else {
          $(this).hide();
        }
      });
    }

    // Select/Deselect all checkboxes
    document.getElementById('selectAll').addEventListener('change', function () {
      const checkboxes = document.querySelectorAll('input[name="job_links"]');
      for (let cb of checkboxes) {
        cb.checked = this.checked;
      }
    });
  });
  </script>
</body>
</html> 