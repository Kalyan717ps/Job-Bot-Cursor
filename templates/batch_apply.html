<!DOCTYPE html>
<html>
<head>
  <title>Batch Apply</title>
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
</head>
<body>
  <h2>📦 Batch Apply to Matching Jobs</h2>
  <p>
    <a href="{{ url_for('dashboard') }}">Dashboard</a> |
    <a href="{{ url_for('manual_jobs') }}">Manual Apply</a> |
    <a href="{{ url_for('applications') }}">Applications</a>
  </p>

  {% if jobs %}
    <!-- Search bar -->
    <input type="text" id="jobSearch" placeholder="🔍 Search jobs..." style="width:300px; margin-bottom:10px;">
    <!-- Multi-select filters -->
    <select id="companyFilter" multiple style="width: 300px;">
      {% for job in jobs|unique(attribute='company') %}
        <option value="{{ job.company|lower }}">{{ job.company }}</option>
      {% endfor %}
    </select>
    <select id="titleFilter" multiple style="width: 300px;">
      {% for job in jobs|unique(attribute='title') %}
        <option value="{{ job.title|lower }}">{{ job.title }}</option>
      {% endfor %}
    </select>
    <form method="POST">
      <p>
        <input type="checkbox" id="selectAll"> <label for="selectAll">Select All Jobs</label>
      </p>
      <ul>
        {% for job in jobs %}
        <li class="job-item" data-title="{{ job.title|lower }}" data-company="{{ job.company|lower }}">
          <input type="checkbox" name="job_links" value="{{ job.link }}" checked>
          <strong class="job-title">{{ job.title }}</strong> @
          <span class="job-company">{{ job.company }}</span><br>
          <a href="{{ job.link }}" target="_blank">View Job</a>
        </li><br>
        {% endfor %}
      </ul>
      <button type="submit">🚀 Apply Selected Jobs</button>
    </form>
  {% else %}
    <p>😕 No jobs matched your profile. Try updating <a href="{{ url_for('profile') }}">your profile</a>.</p>
  {% endif %}

  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    $(document).ready(function() {
      $('#companyFilter').select2({ placeholder: 'Filter by company' });
      $('#titleFilter').select2({ placeholder: 'Filter by title' });

      $('#companyFilter, #titleFilter').on('change', function () {
        filterJobs();
      });

      document.getElementById('jobSearch').addEventListener('keyup', filterJobs);

      function filterJobs() {
        const searchText = document.getElementById('jobSearch').value.toLowerCase();
        const selectedCompanies = $('#companyFilter').val();
        const selectedTitles = $('#titleFilter').val();

        document.querySelectorAll(".job-item").forEach(function (job) {
          const title = job.getAttribute("data-title").toLowerCase();
          const company = job.getAttribute("data-company").toLowerCase();
          let visible = true;

          // Keyword search
          if (searchText && !title.includes(searchText) && !company.includes(searchText)) {
            visible = false;
          }

          // Multi-select-match
          if (selectedCompanies && selectedCompanies.length && !selectedCompanies.includes(company)) {
            visible = false;
          }
          if (selectedTitles && selectedTitles.length && !selectedTitles.includes(title)) {
            visible = false;
          }

          job.style.display = visible ? '' : 'none';
        });
      }

      // Select/Deselect all checkboxes
      document.getElementById('selectAll').addEventListener('change', function () {
        const checkboxes = document.querySelectorAll('input[name="job_links"]');
        for (let cb of checkboxes) {
          cb.checked = this.checked;
        }
      });
    });
  </script>
</body>
</html> 