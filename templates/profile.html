<!-- templates/profile.html -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>User Profile</title>
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0/dist/css/select2.min.css" rel="stylesheet" />
  {% include 'navbar.html' %}
</head>
<body>
  <h2>Update Profile</h2>
  {% with messages = get_flashed_messages() %}
    {% if messages %}
      <ul>
        {% for message in messages %}<li>{{ message }}</li>{% endfor %}
      </ul>
    {% endif %}
  {% endwith %}

  <!-- Select2 Styles and Scripts -->
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet"/>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

  <form method="POST" enctype="multipart/form-data">
    <label for="title">Preferred Job Titles:</label><br>
    <select id="title" name="title" multiple style="width: 300px;" required>
      {% set selected_titles = profile.preferred_title.split(',') if profile and profile.preferred_title else [] %}
      {% for job in jobs|unique(attribute='title') %}
        <option value="{{ job.title }}"
          {% if job.title in selected_titles %}selected{% endif %}>
          {{ job.title }}
        </option>
      {% endfor %}
    </select><br><br>

    <label for="location">Preferred Locations:</label><br>
    <select id="location" name="location" multiple style="width: 300px;">
      {% set selected_locations = profile.preferred_location.split(',') if profile and profile.preferred_location else [] %}
      {% for job in jobs|unique(attribute='company') %}
        <option value="{{ job.company }}"
          {% if job.company in selected_locations %}selected{% endif %}>
          {{ job.company }}
        </option>
      {% endfor %}
    </select><br><br>

    {% if profile and profile.resume_filename %}
      <div style="margin-bottom:15px;">
        <strong>Your Resume:</strong>
        <a href="{{ url_for('view_resume', filename=profile.resume_filename) }}" target="_blank">
          ðŸ§¾ View / Download Resume
        </a>
      </div>
    {% endif %}

    <label for="resume">Resume Upload (PDF/DOCX):</label><br>
    <input type="file" name="resume"><br><br>

    <button type="submit">Save Profile</button>
  </form>

  <script>
$(function() {
  $('#title').select2({ tags: true, placeholder: 'Select or enter job titles', width: 'resolve' });
  $('#location').select2({ tags: true, placeholder: 'Select or enter locations', width: 'resolve' });
});
  </script>
</body>
</html> 